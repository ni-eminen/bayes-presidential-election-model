---
title: "BDA - Project"
author: "Anonymous"
output:
  html_document:
    toc: yes
    toc_depth: '1'
    df_print: paged
  pdf_document:
    toc: yes
    toc_depth: 1
urlcolor: blue
---

```{r, include=FALSE}
library(aaltobda)
library(bayesplot)
library(cmdstanr)
library(dplyr)
library(ggplot2)
library(ggdist) # for stat_dotsinterval
library(posterior)
library(brms)
# Set more readable themes with bigger font for plotting packages.
ggplot2::theme_set(theme_minimal(base_size = 14))
bayesplot::bayesplot_theme_set(theme_minimal(base_size = 14))
# This registers CmdStan as the backend for compiling cmdstan-chunks.
check_cmdstan_toolchain(fix = TRUE, quiet = TRUE)
register_knitr_engine(override = FALSE)
```

```{r}
library(dslabs)
data("polls_us_election_2016")
y_clinton = polls_us_election_2016$samplesize*polls_us_election_2016$rawpoll_clinton/100
y_trump = polls_us_election_2016$samplesize*polls_us_election_2016$rawpoll_trump/100
y_johnson = polls_us_election_2016$samplesize*polls_us_election_2016$rawpoll_johnson/100

state_names = unique(polls_us_election_2016$state)
state_ids = c(1:length(state_names))
names(state_ids) = state_names

election_data =  data.frame(state_ids[polls_us_election_2016$state], 
                            polls_us_election_2016$samplesize, 
                            as.integer(y_clinton), 
                            as.integer(y_trump), 
                            as.integer(y_johnson))
names(election_data) <- c("state","samplesize","y_clinton","y_trump","y_johnson")
election_data = na.omit(election_data)
```

```{r, message=FALSE}
stan_data = list(N_observations=nrow(election_data),
                 N_states=length(unique(election_data$state)), 
                 samplesize = election_data$samplesize,
                 state_idx = election_data$state, 
                 y_clinton = election_data$y_clinton,
                 y_trump = election_data$y_trump,
                 y_johnson = election_data$y_johnson)

pooled_model = cmdstan_model("huy_project_pooled_model.stan")
fit_pooled <- pooled_model$sample(data = stan_data, refresh=0, show_messages=FALSE)
```

